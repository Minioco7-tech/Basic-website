<!DOCTYPE html>
<html lang="en">
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AIviary ‚Äî Search Results</title>
<link rel="icon" type="image/x-icon" href="/static/favicon.ico">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/feather-icons"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; }
    .model-tile { transition: all 0.4s cubic-bezier(0.175,0.885,0.32,1.275); transform-origin: center; }
    .model-tile:hover { transform: scale(1.05); z-index: 10; }
</style>
</head>
<body class="text-white">

<nav class="bg-black bg-opacity-20 backdrop-blur-lg border-b border-white border-opacity-10 sticky top-0 z-50 p-4 flex justify-between items-center">
  <a href="index.html" class="flex items-center space-x-3 group">
    <div class="w-8 h-8 bg-gradient-to-r from-purple-400 to-pink-400 rounded-lg flex items-center justify-center transition-transform duration-300 group-hover:scale-110">
      <i data-feather="zap" class="w-4 h-4"></i>
    </div>
    <span class="text-xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent group-hover:opacity-80 transition-opacity duration-300">
      AIviary
    </span>
  </a>
</nav>

    <!-- Header -->
    <header class="p-6 flex justify-between items-center border-b border-white border-opacity-10">
        <h1 class="text-2xl font-bold">üîç AIviary Search</h1>
        <a href="index.html" class="text-sm text-gray-300 hover:text-white transition">Back to Home</a>
    </header>

    <!-- Search Results Section -->
    <main class="flex-1 container mx-auto px-4 py-10">
         
        <div class="flex justify-between items-center mb-6">
            <h2 id="categoryTitle" class="text-2xl font-bold"></h2>
            <!-- Sort By Dropdown -->
            <select id="sortBy" class="px-3 py-2 bg-gray-800 text-white rounded-lg text-sm">
                <option value="relevance">Relevance</option>
                <option value="az">A ‚Üí Z</option>
                <option value="za">Z ‚Üí A</option>
            </select>
            <!-- Randomise Button -->
            <button id="randomiseBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white text-sm rounded-lg transition flex items-center space-x-2">
                <i data-feather="shuffle" class="w-4 h-4"></i>
                <span>Randomise</span>
            </button>
        </div>
        
        <div id="resultsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
        <div id="noResults" class="text-center text-gray-400 mt-12 hidden">
            No results found for "<span id="queryText" class="text-white"></span>" üòï
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-500 py-4 border-t border-white border-opacity-10">
        ¬© 2025 AIviary. All rights reserved.
    </footer>

    <script>
    const resultsGrid = document.getElementById('resultsGrid');
    const noResults = document.getElementById('noResults');
    const queryText = document.getElementById('queryText');
    const randomiseBtn = document.getElementById('randomiseBtn');
    const sortBySelect = document.getElementById('sortBy');
    const stopwords = ['i','want','to','a','the','and','for','of','in','on','is','with','my','you','it','this','that','at'];
    
        
    // Get query from URL
    const params = new URLSearchParams(window.location.search);
    const searchQuery = params.get('q')?.trim().toLowerCase() || '';

    // Display search term
    queryText.textContent = searchQuery;

    // Global array to store models currently displayed
    let currentModels = [];

    // ‚úÖ Category synonyms for natural matching
    const categorySynonyms = {
        writing: ['writing', 'writer', 'content', 'copy', 'text', 'document', 'email'],
        design: ['design', 'art', 'image', 'photo', 'logo', 'graphic', 'visual'],
        learning: ['learning', 'education', 'research', 'study', 'teach', 'knowledge'],
        business: ['business', 'marketing', 'sales', 'brand', 'startup', 'work', 'help'],
        chatbots: ['chat', 'bot', 'assistant', 'agent', 'conversation', 'support'],
        music: ['music', 'audio', 'sound', 'song', 'beat', 'voice', 'sing'],
        coding: ['code', 'coding', 'developer', 'programming', 'software', 'tech'],
        science: ['science', 'health', 'medicine', 'bio', 'lab', 'research'],
        finance: ['finance', 'money', 'analytics', 'data', 'economy', 'bank', 'invest'],
        health: ['health', 'fitness', 'wellbeing', 'medical', 'care', 'wellness']
    };

    // Helper: check if query matches a category
    function getMatchedCategory(keywords) {
        for (const [key, synonyms] of Object.entries(categorySynonyms)) {
            if (keywords.some(word => synonyms.includes(word))) return key;
        }
        return null;
    }

    // --------------------------
    // Reusable function to render models
    // --------------------------
    function displayModels(models) {
        resultsGrid.innerHTML = '';
        models.forEach(model => {
            const card = document.createElement('div');
            card.className = 'bg-black bg-opacity-30 rounded-xl overflow-hidden hover:scale-105 transition transform duration-300 border border-white border-opacity-10';
            card.innerHTML = `
                <div class="w-full h-40 bg-cover bg-center" style="background-image: url('${model.image}')"></div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold mb-2">${model.name}</h3>
                    <p class="text-sm text-gray-300 mb-3 line-clamp-2">${model.description}</p>
                    <div class="flex justify-between items-center text-xs text-gray-400">
                        <span>${model.category}</span>
                        <a href="model.html?id=${encodeURIComponent(model.id)}" class="text-purple-400 hover:text-purple-300">View ‚Üí</a>
                    </div>
                </div>
            `;
            resultsGrid.appendChild(card);
        });
    }    

    function sortModels(models, criteria) {
        const sorted = [...models]; // copy array
        switch(criteria) {
            case 'az':
                sorted.sort((a, b) => a.name.localeCompare(b.name));
                break;
            case 'za':
                sorted.sort((a, b) => b.name.localeCompare(a.name));
                break;
            case 'relevance':
            default:
                // Already sorted by relevance/fuzzy score
                break;
        }
        return sorted;
    }
    
    // Listen for changes in dropdown
    sortBySelect.addEventListener('change', () => {
        if (!currentModels.length) return;
    
        const sortedModels = sortModels(currentModels, sortBySelect.value);
        displayModels(sortedModels);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });


    // Fisher‚ÄìYates shuffle (mobile-safe)
    function shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }
    
    // Enhanced natural search logic
    async function fetchAndDisplayResults() {
        try {
            const response = await fetch('./models.json');
            if (!response.ok) throw new Error('Failed to load models.json');
            const models = await response.json();
    
           
            const keywords = searchQuery
                .split(/\s+/)
                .map(w => w.toLowerCase())
                .filter(Boolean)
                .filter(word => !stopwords.includes(word));
    
            let filtered = [];
            const matchedCategory = getMatchedCategory(keywords);
    
            // Show all models for general queries like "all"
            if (['all', 'everything', 'all tools', 'catalogue', 'all models', 'show all models'].includes(searchQuery)) {
                filtered = models;
            } 
            // Match category if found
            else if (matchedCategory) {
                filtered = models.filter(m => m.category.toLowerCase() === matchedCategory);
            } 
            // General fuzzy search with Fuse.js
            else {
                const fuse = new Fuse(models, {
                    keys: ['name', 'description', 'category', 'type'],
                    threshold: 0.4,        // fuzzy tolerance
                    ignoreLocation: true,
                    includeScore: true
                });
    
                filtered = fuse.search(searchQuery).map(result => result.item);
            }

            currentModels = filtered;

            // Apply sorting based on dropdown selection
            currentModels = sortModels(currentModels, sortBySelect.value);
    
            // Randomize results slightly for variety
            currentModels = currentModels.sort(() => 0.5 - Math.random());
    
            // Display results or show noResults
            if (currentModels.length === 0) {
                noResults.classList.remove('hidden');
                return;
            } else {
                noResults.classList.add('hidden');
            }
    
            
        displayModels(currentModels);
    
        } catch (error) {
            console.error('Error loading models:', error);
            noResults.classList.remove('hidden');
        }
    }

    // Randomise button functionality with smooth reshuffle
    randomiseBtn.addEventListener('click', () => {
        if (!currentModels.length) return;
    
        // Shuffle models
        currentModels = shuffleArray(currentModels);
    
        // Clear grid to force repaint
        resultsGrid.innerHTML = '';
    
        // Repaint on next animation frame for smoothness
        requestAnimationFrame(() => {
            displayModels(currentModels);
            window.scrollTo({ top: 0, behavior: 'smooth' });
    
            // Force mobile browsers to repaint (esp. iOS Safari)
            setTimeout(() => {
                document.body.style.transform = 'translateZ(0)';
            }, 100);
        });
    });
    fetchAndDisplayResults();
    feather.replace();
    </script>
</body>
</html>
