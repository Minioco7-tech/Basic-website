<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results | AIviary</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="bg-gradient-to-b from-gray-900 to-black text-white min-h-screen flex flex-col">

    <!-- Header -->
    <header class="p-6 flex justify-between items-center border-b border-white border-opacity-10">
        <h1 class="text-2xl font-bold">üîç AIviary Search</h1>
        <a href="index.html" class="text-sm text-gray-300 hover:text-white transition">Back to Home</a>
    </header>

    <!-- Search Results Section -->
    <main class="flex-1 container mx-auto px-4 py-10">
        <h2 class="text-2xl font-bold mb-6">Search Results</h2>
        <div id="resultsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
        <div id="noResults" class="text-center text-gray-400 mt-12 hidden">
            No results found for "<span id="queryText" class="text-white"></span>" üòï
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-500 py-4 border-t border-white border-opacity-10">
        ¬© 2025 AIviary. All rights reserved.
    </footer>

    <script>
        const resultsGrid = document.getElementById('resultsGrid');
        const noResults = document.getElementById('noResults');
        const queryText = document.getElementById('queryText');

        // Get query from URL
        const params = new URLSearchParams(window.location.search);
        const searchQuery = params.get('q')?.trim().toLowerCase() || '';

        // Display search term
        queryText.textContent = searchQuery;

        // Fetch and display models
        async function fetchAndDisplayResults() {
            try {
                const response = await fetch('./models.json');
                if (!response.ok) throw new Error('Failed to load models.json');
                const models = await response.json();

               // --- Enhanced Search Logic --- //
                const categories = {
                    all:'All',
                    writing: 'Writing',
                    design: 'Design',
                    learning: 'Learning',
                    business: 'Business',
                    chatbots: 'Chatbots',
                    music: 'Music',
                    coding: 'Coding',
                    science: 'Science',
                    finance: 'Finance',
                    health: 'Health'
                };
                
                // Check if the query matches a known category key or name
                const categoryMatch = Object.keys(categories).find(
                    key =>
                        searchQuery === key ||
                        categories[key].toLowerCase().includes(searchQuery)
                );
                
                let filtered;
                
                if (searchQuery === 'all' || searchQuery === 'everything' || searchQuery === 'all tools' || searchQuery === 'catalogue') {
                    // Show *everything*
                    filtered = models;
                } else if (categoryMatch) {
                    // Show all models from that category
                    filtered = models.filter(m => m.category === categoryMatch);
                } else {
                    // Default: keyword match (less strict)
                    filtered = models.filter(m =>
                        m.name.toLowerCase().includes(searchQuery) ||
                        m.description.toLowerCase().includes(searchQuery) ||
                        m.category.toLowerCase().includes(searchQuery)
                    );
                }

                // üîÄ Randomize the order of the results
                filtered = filtered.sort(() => 0.5 - Math.random());

                if (filtered.length === 0) {
                    noResults.classList.remove('hidden');
                    return;
                }

                filtered.forEach(model => {
                    const card = document.createElement('div');
                    card.className = 'bg-black bg-opacity-30 rounded-xl overflow-hidden hover:scale-105 transition transform duration-300 border border-white border-opacity-10';
                    card.innerHTML = `
                        <div class="w-full h-40 bg-cover bg-center" style="background-image: url('${model.image}')"></div>
                        <div class="p-4">
                            <h3 class="text-lg font-semibold mb-2">${model.name}</h3>
                            <p class="text-sm text-gray-300 mb-3 line-clamp-2">${model.description}</p>
                            <div class="flex justify-between items-center text-xs text-gray-400">
                                <span>${model.category}</span>
                                <a href="model.html?id=${encodeURIComponent(model.id)}" class="text-purple-400 hover:text-purple-300">View ‚Üí</a>
                            </div>
                        </div>
                    `;
                    resultsGrid.appendChild(card);
                });
            } catch (error) {
                console.error('Error loading models:', error);
                noResults.classList.remove('hidden');
            }
        }

        fetchAndDisplayResults();
    </script>
</body>
</html>
